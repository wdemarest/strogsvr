if [ ! -f ~/.ssh/CandyHop.pem ]; then
    echo "You must have a file ~/.ssh/CandyHop.pem that can access the server ubuntu@playcandyhop.com"
    echo "Please correct this and try again."
    exit 1
fi

if [ "$1" != "deploy" ] && [ "$1" != "stop" ] && [ "$1" != "start" ] && [ "$1" != "restart" ] && [ "$1" != "watch" ]
then
echo "pch takes one of the following parameters:"
echo "* deploy [server|candyhop|reactor]  - deploys to and overwrites server
echo "* start    - starts the server"
echo "* restart  - re-starts the server"
echo "* stop     - stops the server at"
echo "* watch    - emits the logfile from the server"
exit 1
fi

#
# WARNING: Deploy only works if you have already made the target directory on the server.
#

if [ "$1" == "deploy" ] && [ "$2" == "strogsvr" ]
then
echo Deploying from github.com/wdemarest/strogsvr to playcandyhop.com
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "cd ~/strogsvr ; git fetch --all ; git reset --hard origin/master"
fi

if [ "$1" == "deploy" ] && [ "$2" == "candyhop" ]
then
echo Deploying from github.com/wdemarest/candyhop to playcandyhop.com
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "cd ~/candyhop ; git fetch --all ; git reset --hard origin/master"
fi

if [ "$1" == "deploy" ] && [ "$2" == "reactor" ]
then
echo Deploying from github.com/wdemarest/reactorRescue to playcandyhop.com
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "cd ~/reactorRescue ; git fetch --all ; git reset --hard origin/master"
fi

if [ "$1" == "stop" ] || [ "$1" == "restart" ]
then
echo Stopping candyhop on playcandyhop.com
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "pkill nodejs"
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "ps ax | grep n[o]dejs.*server.js"
fi

if [ "$1" == "start" ] || [ "$1" == "restart" ]
then
echo Starting candyhop on playcandyhop.com
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "cd ~/candyhop ; nohup nodejs /usr/local/bin/supervisor -x nodejs -n error ./server.js >> ~/candyhop/candyhop.log 2>&1 &"
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "ps ax | grep n[o]dejs.*server.js"
fi

if [ "$1" == "watch" ]
then
ssh ubuntu@playcandyhop.com -i ~/.ssh/CandyHop.pem "tail -f -n 100 ~/candyhop/candyhop.log"
fi

